<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test auth</title>
    <link rel="stylesheet" href="style.css">


    <script src="https://www.gstatic.com/firebasejs/4.10.0/firebase.js"></script>
    <script>
        let loaded = function() {


            // Initialize Firebase
            var config = {
                apiKey: "AIzaSyAl6h2TDLbhuqPvCcRenX7KVgvtPtJVUDE",
                authDomain: "bringmybeerbro-a2b2e.firebaseapp.com",
                databaseURL: "https://bringmybeerbro-a2b2e.firebaseio.com",
                projectId: "bringmybeerbro-a2b2e",
                storageBucket: "bringmybeerbro-a2b2e.appspot.com",
                messagingSenderId: "787446559372"
            };
            firebase.initializeApp(config);

            let db = firebase.database();

            
            let facebookProvider = new firebase.auth.FacebookAuthProvider();
            let googleProvider = new firebase.auth.GoogleAuthProvider();
            
            let logInWithFb = document.getElementById("test");
            let logInWithgoogle = document.getElementById("google");
            
            logInWithgoogle.addEventListener("click" , function(event){
                firebase.auth().signInWithRedirect(googleProvider);
            });

            logInWithFb.addEventListener("click", function(event) {
                console.log("Clicked");
                firebase.auth().signInWithRedirect(facebookProvider);

            });

            firebase.auth().getRedirectResult().then(function(result) {
                if (result.credential) {
                    // This gives you a Facebook Access Token. You can use it to access the Facebook API.
                    var token = result.credential.accessToken;
                    // ...
                }
                // The signed-in user info.
                var user = result.user;
            }).catch(function(error) {
                // Handle Errors here.
                var errorCode = error.code;
                var errorMessage = error.message;
                // The email of the user's account used.
                var email = error.email;
                // The firebase.auth.AuthCredential type that was used.
                var credential = error.credential;
                // ...
            });


            firebase.auth().onAuthStateChanged(function(user) {


                
                let imgcontainer = document.createElement("div");
                let img = document.createElement("img");
                let name = document.createElement("span");


                if (user) {
                    // User is signed in.
                    var displayName = user.providerData[0].displayName;
                    var email = user.email;
                    var emailVerified = user.emailVerified;
                    var photoURL = user.providerData[0].photoURL;
                    var isAnonymous = user.isAnonymous;
                    var uid = user.providerData[0].uid;
                    var providerData = user.providerData;

                    console.log('onAuthStateChanged: user is signed in', user);
                    console.log("User logged in..");
                    imgcontainer.className = "imgDiv";
                    
                    img.src = `${user.photoURL}`;
                    img.className = "userImg";
                    imgcontainer.appendChild(img);
                    name.innerHTML = `${user.displayName}`;
                    main.appendChild(imgcontainer);
                    main.appendChild(name);


                } else {
                    console.log("No User");
                    name.innerHTML="";
                    img.src = "";

                }
            });


            let loggedOutBtn = document.getElementById('logOut');

            let logOut = function(event) {
                firebase.auth().signOut().then(function(result) {
                    document.getElementsByTagName("main")[0].innerHTML ="";
                    
                    console.log('User signed out');
                    })
                    .catch(function(error) {
                        console.log('Signout failed');
                    });
            }

            loggedOutBtn.addEventListener('click', logOut)
        }
        window.addEventListener("load", loaded);
    </script>
</head>

<body>
   <header>
    </header>
    <main>
        <button id="googleBtn">Log in with Google</button>
        <button id="facebookBtn"> Log in with FB</button>
        <button id="logOut"> Log out</button>
    
    </main>
    
    <footer></footer>

</body>

</html>